<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <h5 class="headerTitle">Recepción Check-in</h5>
    <ion-buttons slot="end">
      <ion-icon name="close-outline" color="medium" style="font-size: 1.8rem" (click)="presentAlert()"></ion-icon>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="cod-gray-bg-50">
  <div class="main-content">
    <form *ngIf="cita; else loading">

      <!-- SECCIÓN DE INFO DEL CLIENTE (CLEAN CARD - NEW DESIGN) -->
      <ion-card class="client-card">
        <div class="client-content">
          <div class="avatar-container">
            <ion-icon name="person-sharp"></ion-icon>
          </div>
          <div class="text-container">
            <h2 class="client-name">{{cita.ClientNames | titlecase}} {{cita.ClientSurnames | titlecase}}</h2>
            <p class="appointment-id">Cita #{{cita.NumberOfAppointment}}</p>
          </div>
        </div>
      </ion-card>

      <!-- CONTENIDO PRINCIPAL: CHASSIS, SERVICIOS, ETC. -->
      <div class="form-container">
        <!-- TARJETA 1: CHASSIS -->
        <ion-card class="serviceCard">
          <label for="type" class="serviceSubTitle">Chassis</label>
          <ion-item lines="none" class="ion-no-padding">
            <ion-input class="serviceTitle" placeholder="Chassis vehículo" [disabled]="verificateChassis"
              [(ngModel)]="writedChassis" [ngModelOptions]="{standalone: true}"></ion-input>
            <ion-button [color]="verificateChassis === true ? 'success' : 'secondary'" [disabled]="verificateChassis"
              (click)="hasChassis(writedChassis)" class="ion-margin-start">
              {{ verificateChassis === true ? 'Válido' : 'Validar'}}
            </ion-button>
          </ion-item>
        </ion-card>

        <!-- TARJETA 2: SERVICIOS -->
        <ion-card class="serviceCard services-card">
          <label for="service" class="serviceSubTitle">Servicios</label>
          <ion-list class="ion-no-padding" lines="full">
            <ion-item *ngFor="let s of cita.Services" class="service-item">
              <span class="serviceTitle ion-text-wrap">
                {{s.ServiceDescription | lowercase | titlecase}}
              </span>
            </ion-item>
          </ion-list>
        </ion-card>

        <!-- TARJETA 3: TIPO DE CITA -->
        <ion-card class="serviceCard">
          <label for="type" class="serviceSubTitle">Tipo de Cita</label>
          <span class="serviceTitle">{{cita.TypeDescription}}</span>
        </ion-card>

        <!-- TARJETA 4 & 5: CAMPAÑAS Y MANTENIMIENTOS (FLEX ROW) -->
        <div class="card-row">
          <ion-card class="serviceCard-row">
            <div class="ion-align-items-center">
              <span class="serviceTitle">Campañas activas</span>
            </div>
            <div>
              <ion-button fill="clear" color="tertiary" (click)="openModal()">
                <ion-badge color="warning" slot="start">{{cita.VehicleCampaigns?.length || 0}}</ion-badge>
                <ion-icon name="notifications" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </ion-card>

          <ion-card class="serviceCard-row">
            <div class="ion-align-items-center">
              <span class="serviceTitle">Mant. anteriores</span>
            </div>
            <div>
              <ion-button fill="clear" color="tertiary" (click)="openMantModal()">
                <ion-icon name="build-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </ion-card>
        </div>

        <!-- TOGGLES DE OPCIONES -->
        <ion-card class="serviceCard ion-margin-top toggle-group">
          <div class="selectBox">
            <h6 class="serviceTitle">Recepción a domicilio</h6>
            <ion-toggle color="primary" [(ngModel)]="home" [ngModelOptions]="{standalone: true}"></ion-toggle>
          </div>

          <div class="selectBox">
            <h6 class="serviceTitle">Vehículo en grúa</h6>
            <ion-toggle color="primary" [(ngModel)]="crane" [ngModelOptions]="{standalone: true}"></ion-toggle>
          </div>

          <div class="selectBox">
            <h6 class="serviceTitle">Vehículo en emergencia</h6>
            <ion-toggle color="primary" [(ngModel)]="isEmergency" [ngModelOptions]="{standalone: true}"></ion-toggle>
          </div>
        </ion-card>
      </div>

    </form>

    <ng-template #loading>
      <div class="userInfo ion-padding-vertical cod-gray-bg-500">
        <div style="display: flex; justify-content: center; width: 100%;">
          <ion-skeleton-text animated style="width: 4rem; height: 4rem; border-radius: 50%"></ion-skeleton-text>
        </div>
        <ion-skeleton-text animated
          style="width: 60%; height: 24px; margin-top: 8px; margin-bottom: 4px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 40%; height: 16px;"></ion-skeleton-text>
      </div>

      <div class="form-container">
        <ion-card class="serviceCard">
          <ion-skeleton-text animated style="width: 30%; height: 16px; margin-bottom: 8px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 100%; height: 40px; border-radius: 8px;"></ion-skeleton-text>
        </ion-card>

        <ion-card class="serviceCard">
          <ion-skeleton-text animated style="width: 30%; height: 16px; margin-bottom: 8px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 100%; height: 20px; margin-bottom: 8px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 90%; height: 20px; margin-bottom: 8px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 80%; height: 20px; margin-bottom: 8px;"></ion-skeleton-text>
        </ion-card>

        <ion-card class="serviceCard">
          <ion-skeleton-text animated style="width: 30%; height: 16px; margin-bottom: 8px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 50%; height: 20px;"></ion-skeleton-text>
        </ion-card>
      </div>
    </ng-template>
  </div>
</ion-content>

<ion-footer class="ion-no-border">
  <ion-toolbar style="--background: transparent; padding: 0 16px 16px 16px;">
    <app-shared-button label="Iniciar Recepción" [disabled]="!canStart" (onClick)="next()"></app-shared-button>
  </ion-toolbar>
</ion-footer>